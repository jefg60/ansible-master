<VirtualHost _default_:443>
    ServerName {{ anmad_host }}

    SSLEngine on
    SSLCertificateFile /etc/letsencrypt/live/{{ anmad_host }}/fullchain.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/{{ anmad_host }}/privkey.pem

    ErrorLog {{ apache_log_path }}/anmad-error.log
    LogLevel warn
    CustomLog {{ apache_log_path }}/anmad-access.log combined

    WSGIDaemonProcess anmad_buttons.py user={{ ansible_orchestration_user }} group={{ ansible_orchestration_group }} threads=4 python-home={{ ara.install.pip.virtualenv_path }} python-path=/srv/anmad

    WSGIScriptAlias / /srv/anmad/anmad.wsgi
    WSGIProcessGroup anmad_buttons.py
    WSGIApplicationGroup %{GLOBAL}

    <Directory /srv/anmad>
        <Files "anmad.wsgi">
            AuthType Basic
            AuthName "Authentication Required"
            AuthUserFile "/etc/htpasswd/.htpasswd"
            Require valid-user
        </Files>
    </Directory>
</VirtualHost>
